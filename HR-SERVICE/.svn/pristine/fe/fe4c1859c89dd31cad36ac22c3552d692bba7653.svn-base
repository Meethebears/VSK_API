using System.Threading.Tasks;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.IO;
using System.Configuration;
using System.Diagnostics;

namespace API.Controllers
{
    public class PictureUploadsController : Controller
    {
        public ActionResult UploadFile(HttpPostedFileBase postedFile, string pathname)
        {
            string strFolder;
            strFolder = Server.MapPath("./");

            if (postedFile != null)
            {
                string path = ConfigurationManager.AppSettings["PathUpload"] + "\\" + pathname + "\\";
                //string path = ConfigurationManager.AppSettings["PathUpload"] + '//'+; ;

                //string path = Server.MapPath("C:/uploads/");

                if (!Directory.Exists(path))
                {
                    Directory.CreateDirectory(path);
                }

                DateTime serverDate = DateTime.Now;
                string currentDateString = string.Format("{0}", serverDate.ToString("ssffffff"));

                postedFile.SaveAs(path + currentDateString + '_' + Path.GetFileName(postedFile.FileName.Replace(" ", "")));

                return Json(currentDateString + '_' + Path.GetFileName(postedFile.FileName), JsonRequestBehavior.AllowGet);
            }
            else
            {

                return Json("File uploaded error.", JsonRequestBehavior.AllowGet);

            }

        }

    }
}
